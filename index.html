<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Juno</title>
    <script src="riot.js"></script>
    <style>
      body {
        margin: 0;
        font: menu;
        -webkit-user-select: none;
        cursor: default;
      }
    </style>
    <link rel="stylesheet" href="font-awesome/css/font-awesome.css" />
  </head>
  <body>
    <file-list></file-list>
    <notebook-tabs></notebook-tabs>
    <login-view></login-view>
    <connect-page></connect-page>
    <script src="tags.js"></script>
    <script>
      'use strict';
      var list = riot.mount("file-list")[0];
      var tabs = riot.mount("notebook-tabs")[0];
      var login = riot.mount("login-view")[0];
      var connect = riot.mount("connect-page")[0];
      riot.host = undefined;
      riot.openUrl = function (url) {
        if (riot.host === undefined)
          throw "Host hasn't been set."
        
        if (url.slice(0, riot.host.length) == riot.host)
          return tabs.openNotebook(url);
        require("electron").shell.openExternal(url);
      }
      riot.login = function (url, callback) {
        login.login(url, callback);
      }
      riot.newFile = function (type, directory, kernel_name) {
        list.newFile(type, directory, kernel_name);
      }
      riot.formatPath = function (path) {
        let home = require("electron").remote.app.getPath("home");
        if (path.slice(0, home.length) == home)
          return "~" + path.slice(home.length, path.length);
        return path;
      }
      
      var ipcRenderer = require("electron").ipcRenderer;
      ipcRenderer.on('set-host', function (event, host, path) {
        riot.host = host;
        if (riot.host) {
          list.loadFiles("", riot.host, path);
          connect.close();
        } else {
          connect.open();
        }
      });
      ipcRenderer.on('toggle-dev-tools', function (event, message) {
        tabs.toggleDevTools();
      });
      
      window.onbeforeunload = function (event) {
        event.returnValue = tabs.closeAll();
      }
    </script>
  </body>
</html>
