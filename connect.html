<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Open Notebook</title>
    <style>
      body {
        font: menu;
        background-color: #eee;
        -webkit-user-select: none;
      }
      
      h1 {
        font-size: 1.44em;
      }
      h2 {
        font-size: 1.2em;
        margin-bottom: 0;
      }
      
      ul {
        padding-left: 0;
        list-style: none;
      }
      li {
        margin: 0.4em 0;
      }
      a {
        text-decoration: none;
        color: black;
      }
      a:hover {
        text-decoration: underline;
      }
      
      form:invalid input[type=submit]{
        color: #999;
      }
    </style>
    <link rel="stylesheet" href="font-awesome/css/font-awesome.css" />
    <script>
      'use strict';
      let electron = require("electron");
      
      function connect(host) {
        electron.ipcRenderer.send('open-host', host);
      }
      
      function createLi(host) {
        let a = document.createElement("a");
        a.href = "#";
        a.innerHTML = host;
        a.addEventListener("click", function (event) { connect(host); });
        let li = document.createElement("li");
        li.appendChild(a);
        return li;
      }
      
      electron.ipcRenderer.on('close', function (event, message) {
        //window.close();  // TODO: Figure out how to close this window without hanging notebook creation.
      });
      
      document.addEventListener("DOMContentLoaded", function (event) {
        let hosts = [];
        try {
          hosts = JSON.parse(localStorage.recentHosts);
        } catch (e) {
          // pass
        }
        
        let hostsEl = document.querySelector("#hosts");
        for (let i in hosts)
          hostsEl.appendChild(createLi(hosts[i]));
        
        let form = document.querySelector("#host-form");
        form.addEventListener("submit", function (event) {
          let host = document.querySelector("#host-input").value;
          connect(host);
        });
        
        let file = document.querySelector("#file-input");
        file.addEventListener("change", function (event) {
          let files = event.target.files;
          if (files.length > 0)
            connect(files[0].path);
        });
        
        let scrollHeight = document.body.scrollHeight;
        if (scrollHeight > document.documentElement.clientHeight)
          electron.remote.getCurrentWindow().setContentSize(document.documentElement.clientWidth, scrollHeight);
      });
    </script>
  </head>
  <body>
    <h1>Recent Notebooks</h1>
    <ul id="hosts"></ul>
    <h2>Open local notebook</h2>
    <form>
      <input type="file" id="file-input" />
    </form>
    <h2>Connect to server</h2>
    <form id="host-form">
      <input type="url" id="host-input" placeholder="http://localhost:8888" required />
      <input type="submit" value="Connect" />
    </form>
  </body>
</html>
